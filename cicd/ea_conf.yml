# Variable size of Matrix

.multi_target:
    parallel:
        matrix:
            - FPGA_BOARD: [u55c,u280]
              EA: [acme, openpiton]

.implementation_needs:              
  needs:
    - "synthesis: [u280, acme]"
    - "synthesis: [u55c, acme]"
    - "synthesis: [u280, openpiton]"
    - "synthesis: [u55c, openpiton]"

.bitstream_needs: 
  needs:
    - "implementation: [u280, acme]"
    - "implementation: [u55c, acme]"
    - "implementation: [u280, openpiton]"
    - "implementation: [u55c, openpiton]"
.fpga-test_needs:
  needs:
    - EA-sdk
    - "bitstream: [u280, acme]"
    - "bitstream: [u55c, acme]"
    - "bitstream: [u280, openpiton]"
    - "bitstream: [u55c, openpiton]"

.deploy_needs:
  needs:
    - "bitstream: [u280, acme]"
    - "bitstream: [u55c, acme]"
    - "fpga-test: [u280, acme]"
    - "fpga-test: [u55c, acme]"
    - "bitstream: [u280, openpiton]"
    - "bitstream: [u55c, openpiton]"
    - "fpga-test: [u280, openpiton]"
    - "fpga-test: [u55c, openpiton]"

.default_tags:
  tags:
    - MEEP_FPGA

.common_conf:
  rules:
    - !reference [.default_rules, rules]    
  variables:
    GIT_SUBMODULE_STRATEGY: "none"
  parallel: !reference [.multi_target, parallel]  
  timeout: 8h
  tags: !reference [.default_tags, tags] 
  # Don't block successfull builds in the matrix:
  # This would benefit from variable dependencies/needs, but that's not supported
  allow_failure: true  
