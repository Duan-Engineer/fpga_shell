
.setup:
  variables: 
        EMULATED_ACCELERATOR: dvino
        FPGA_BOARD: u280
        GIT_SUBMODULE_STRATEGY: recursive
        NUMBER_OF_JOBS: "8"
        FPGA_LOG_FILE: fpga.log
        TOOLS_DIR: /home/fpga-runnerMEEP/tools/scripts
        QDMA_DRIVERS: /home/dmazure/git_repo/dma_ip_drivers/QDMA/linux-kernel/bin
        BITSTREAM: system_${CI_PIPELINE_ID}.bit
        DEPLOY_DIR: /home/fpga-runnerMEEP/shell_deploy

  rules:
    if: $CI_COMMIT_BRANCH =~ "/^support/"
    

  before_script:
    # This is a Gitlab CI/CD requirement. Use a token-ed URL instead of the regular one. 
    # The load_module script loads the txt file in the support folder. 
    # The extract_url script inserts the token into the repo URL.
    - sh/load_module.sh $EMULATED_ACCELERATOR 
    - sh/extract_url.sh ea_url.txt $RTL_REPO_TOKEN

  tags: MEEP_FPGA

.fpga_test:
  tags: 
    - FPGA_TEST
    # There is a special runner to run the HW test, that targets the correct board
  before_script:
    - export PATH=$PATH:$QDMA_DRIVERS
    - sudo $TOOLS_DIR/givememyuart

  script:
    - source $ACC_DIR/scripts/$BOOT_SCRIPT binaries/fw_payload.bin
